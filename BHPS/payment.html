<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Payment</title>
  <style>
body { font-family: "Segoe UI", Arial, sans-serif; margin:0; background:#f9f9f9; }
header { background:#003366; color:white; padding:12px 24px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; }
header .logo { font-size:20px; font-weight:bold; }
nav a { color:white; margin:0 12px; text-decoration:none; font-size:14px; }
nav a:hover { text-decoration:underline; }
main { display:grid; grid-template-columns:2fr 3fr; gap:32px; padding:24px; max-width:1100px; margin:auto; }
h2 { color:#003366; margin-bottom:12px; }
.card { background:white; padding:20px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.product-line { display:flex; justify-content:space-between; margin:8px 0; transition:0.2s; }
.product-line:hover { background:#f1f6fc; border-radius:6px; padding:6px; }
.product-line + .product-line { border-top:1px solid #eee; padding-top:8px; }
.small { font-size:0.9em; color:#666; }
.summary div { margin:6px 0; }
label { display:block; margin-top:12px; font-weight:600; color:#003366; }
input, select { width:100%; padding:8px; margin-top:4px; border:1px solid #ccc; border-radius:4px; }
button { margin-top:20px; padding:12px; width:100%; background:#003366; color:#fff; border:none; border-radius:6px; font-size:16px; cursor:pointer; transition:0.3s; }
button:hover { background:#0055a5; }
footer {
  text-align:center; 
  padding:12px; 
  font-size:14px; 
  margin-top:30px; 
  position: fixed; 
  bottom: 0;
  left: 0; 
  width: 100%; 
  background-color: #333;
  color: white;
  padding: 15px;
  text-align: center;
  z-index: 1000;
}
form { margin-top:20px; display:flex; flex-direction:column; gap:12px; }
input[type="text"], input[type="email"], input[type="password"], select {
  font-size: 14px;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 100%;
  box-sizing: border-box;
}
.error-msg { font-size:12px; color:red; margin-top:4px; }
.card-icons img { height:24px; margin-right:6px; }
.row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.loading { margin-top:15px; font-weight:bold; color:#0055a5; }
.hidden { display:none; }
.address-section { border: 1px solid #ddd; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
.address-toggle { background: #f5f5f5; border: 1px solid #ddd; padding: 10px; border-radius: 4px; cursor: pointer; margin-bottom: 15px; }
.address-toggle:hover { background: #e9e9e9; }
.same-address-label { font-weight: normal; margin-left: 5px; }

/* Responsive */
@media (max-width: 768px) {
  main { grid-template-columns:1fr; padding:16px; }
  nav a { margin:0 8px; font-size:13px; }
}
@media (max-width: 480px) {
  header { flex-direction:column; align-items:flex-start; }
  header .logo { margin-bottom:8px; }
  nav a { margin:4px 0; }
  .row { grid-template-columns:1fr; }
}
  </style>
</head>
<body>
<header>
  <div class="logo">BookHeaven</div>
  <nav>
    <a href="index.php">Home</a>
    <a href="#">Books</a>
    <a href="#">Cart</a>
    <a href="#">Checkout</a>
  </nav>
</header>

<main>
  <!-- Left column: Order summary -->
  <div class="card">
    <h2>Your Order</h2>
    <div id="orderSummary"></div>
    <div class="summary">
      <div>Subtotal: <span id="subtotal"></span></div>
      <div>Shipping: <span id="shipping"></span></div>
      <strong>Total: <span id="total"></span></strong>
    </div>
  </div>

  <!-- Right column: Checkout form -->
  <div class="card">
    <h2>Payment & Shipping Details</h2>
    
    <!-- Shipping Address Section -->
    <div class="address-section">
      <h3>Shipping Address</h3>
      
      <!-- Toggle for using different address -->
      <div class="address-toggle" id="addressToggle">
        <input type="checkbox" id="differentAddress">
        <label for="differentAddress" class="same-address-label">Use different shipping address</label>
      </div>
      
      <!-- Address Form (initially hidden if user has saved address) -->
      <div id="addressForm">
        <div class="row">
          <div>
            <label for="firstName">First Name *</label>
            <input type="text" id="firstName" required>
            <div class="error-msg" id="firstNameError"></div>
          </div>
          <div>
            <label for="lastName">Last Name *</label>
            <input type="text" id="lastName" required>
            <div class="error-msg" id="lastNameError"></div>
          </div>
        </div>

        <div>
          <label for="address">Address *</label>
          <input type="text" id="address" placeholder="Street address" required>
          <div class="error-msg" id="addressError"></div>
        </div>

        <div>
          <label for="address2">Address Line 2</label>
          <input type="text" id="address2" placeholder="Apartment, suite, unit, etc.">
        </div>

        <div class="row">
          <div>
            <label for="city">City *</label>
            <input type="text" id="city" required>
            <div class="error-msg" id="cityError"></div>
          </div>
          <div>
            <label for="state">State *</label>
            <select id="state" required>
              <option value="">Select State</option>
              <option value="JHR">Johor</option>
              <option value="KDH">Kedah</option>
              <option value="KTN">Kelantan</option>
              <option value="MLK">Melaka</option>
              <option value="NSN">Negeri Sembilan</option>
              <option value="PHG">Pahang</option>
              <option value="PRK">Perak</option>
              <option value="PLS">Perlis</option>
              <option value="PNG">Pulau Pinang</option>
              <option value="SBH">Sabah</option>
              <option value="SWK">Sarawak</option>
              <option value="SGR">Selangor</option>
              <option value="TRG">Terengganu</option>
              <option value="KUL">Kuala Lumpur</option>
              <option value="LBN">Labuan</option>
              <option value="PJY">Putrajaya</option>
            </select>
            <div class="error-msg" id="stateError"></div>
          </div>
        </div>

        <div class="row">
          <div>
            <label for="postcode">Postcode *</label>
            <input type="text" id="postcode" maxlength="5" required>
            <div class="error-msg" id="postcodeError"></div>
          </div>
          <div>
            <label for="country">Country *</label>
            <input type="text" id="country" value="Malaysia" readonly>
          </div>
        </div>

        <div>
          <label for="phone">Phone Number *</label>
          <input type="text" id="phone" placeholder="e.g., 012-345 6789" required>
          <div class="error-msg" id="phoneError"></div>
        </div>
      </div>
    </div>

    <form id="checkoutForm" novalidate>
      <div>
        <label for="email">Email *</label>
        <input type="email" id="email" required>
        <div class="error-msg" id="emailError"></div>
      </div>

      <div>
        <label for="cardNumber">Card Number *</label>
        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" autocomplete="off" required>
        <div class="card-icons">
          <img src="https://img.icons8.com/color/48/visa.png" alt="Visa">
          <img src="https://img.icons8.com/color/48/mastercard.png" alt="MasterCard">
          <img src="https://img.icons8.com/color/48/jcb.png" alt="JCB">
        </div>
        <div class="error-msg" id="cardError"></div>
      </div>

      <div class="row">
        <div>
          <label for="expiry">Expiry (MM/YY) *</label>
          <input type="text" id="expiry" placeholder="MM/YY" required>
          <div class="error-msg" id="expiryError"></div>
        </div>
        <div>
          <label for="cvv">CVV *</label>
          <input type="password" id="cvv" maxlength="4" required>
          <div class="error-msg" id="cvvError"></div>
        </div>
      </div>

      <button type="submit">Pay RM <span id="totalAmount"></span></button>
    </form>
    <div id="loading" class="loading hidden">Processing payment...</div>
  </div>
</main>

<footer>
  Prices, stock and payment options. Accept VISA, MasterCard and JCB.
</footer>

<script>
// Demo cart
const cart = [
  {title:'Danger Days: The True Lives of the Fabulous Killjoys', price:54.90, qty:1},
  {title:'Who Killed Kurt Cobain?', price:79.90, qty:1}
];

// User data (in real scenario, this would come from PHP session/database)
const userData = {
  firstName: 'John',
  lastName: 'Doe',
  email: 'john.doe@example.com',
  address: '123 Main Street',
  address2: 'Apt 4B',
  city: 'Kuala Lumpur',
  state: 'KUL',
  postcode: '50000',
  phone: '012-345 6789'
};

function formatRM(v){return v.toLocaleString('en-MY',{minimumFractionDigits:2,maximumFractionDigits:2})}

function renderSummary(){
  const container=document.getElementById('orderSummary');container.innerHTML='';
  let subtotal=0;
  cart.forEach(item=>{
    subtotal+=item.price*item.qty;
    const line=document.createElement('div');
    line.className='product-line';
    line.innerHTML=`<div><div style="font-weight:600">${item.title}</div><div class="small">Qty ${item.qty}</div></div><div>RM ${formatRM(item.price*item.qty)}</div>`;
    container.appendChild(line);
  });
  const shipping=6.00;
  document.getElementById('subtotal').textContent='RM '+formatRM(subtotal);
  document.getElementById('shipping').textContent='RM '+formatRM(shipping);
  document.getElementById('total').textContent='RM '+formatRM(subtotal+shipping);
  document.getElementById('totalAmount').textContent=formatRM(subtotal+shipping);
}

// Populate user data
function populateUserData() {
  document.getElementById('firstName').value = userData.firstName;
  document.getElementById('lastName').value = userData.lastName;
  document.getElementById('email').value = userData.email;
  document.getElementById('address').value = userData.address;
  document.getElementById('address2').value = userData.address2 || '';
  document.getElementById('city').value = userData.city;
  document.getElementById('state').value = userData.state;
  document.getElementById('postcode').value = userData.postcode;
  document.getElementById('phone').value = userData.phone;
  
  // Initially hide address form if user has saved address
  document.getElementById('addressForm').style.display = 'none';
}

// Toggle address form visibility
document.getElementById('differentAddress').addEventListener('change', function() {
  const addressForm = document.getElementById('addressForm');
  if (this.checked) {
    addressForm.style.display = 'block';
  } else {
    addressForm.style.display = 'none';
    // Reset to user's saved address when unchecked
    populateUserData();
  }
});

// card input helpers
document.getElementById('cardNumber').addEventListener('input',e=>{
  let v=e.target.value.replace(/\D/g,'').slice(0,16);
  v=v.replace(/(\d{4})/g,'$1 ').trim();
  e.target.value=v;
});
document.getElementById('expiry').addEventListener('input',e=>{
  let v=e.target.value.replace(/\D/g,'').slice(0,4);
  if(v.length>2) v=v.slice(0,2)+'/'+v.slice(2);
  e.target.value=v;
});

// Phone number formatting
document.getElementById('phone').addEventListener('input',e=>{
  let v=e.target.value.replace(/\D/g,'').slice(0,11);
  if(v.length>6) v=v.slice(0,3)+'-'+v.slice(3,6)+' '+v.slice(6);
  else if(v.length>3) v=v.slice(0,3)+'-'+v.slice(3);
  e.target.value=v;
});

// Postcode validation
document.getElementById('postcode').addEventListener('input',e=>{
  e.target.value=e.target.value.replace(/\D/g,'').slice(0,5);
});

// Luhn check
function luhnCheck(num){
  const s=num.replace(/\s+/g,'');if(!/^[0-9]{13,19}$/.test(s))return false;
  let sum=0,flip=false;
  for(let i=s.length-1;i>=0;i--){let d=+s[i];if(flip){d*=2;if(d>9)d-=9;}sum+=d;flip=!flip}
  return sum%10===0
}

// Inline validation
function showError(id,msg){
  document.getElementById(id).textContent=msg;
}
function clearErrors(){
  ['emailError','cardError','expiryError','cvvError','firstNameError','lastNameError','addressError','cityError','stateError','postcodeError','phoneError'].forEach(id=>{
    document.getElementById(id).textContent='';
  });
}

// Address validation
function validateAddress() {
  let valid = true;
  const differentAddress = document.getElementById('differentAddress').checked;
  
  if (differentAddress) {
    const firstName = document.getElementById('firstName').value;
    const lastName = document.getElementById('lastName').value;
    const address = document.getElementById('address').value;
    const city = document.getElementById('city').value;
    const state = document.getElementById('state').value;
    const postcode = document.getElementById('postcode').value;
    const phone = document.getElementById('phone').value;
    
    if (!firstName) { showError('firstNameError','First name is required'); valid=false; }
    if (!lastName) { showError('lastNameError','Last name is required'); valid=false; }
    if (!address) { showError('addressError','Address is required'); valid=false; }
    if (!city) { showError('cityError','City is required'); valid=false; }
    if (!state) { showError('stateError','State is required'); valid=false; }
    if (!postcode || postcode.length !== 5) { showError('postcodeError','Valid postcode is required'); valid=false; }
    if (!phone || phone.replace(/\D/g,'').length < 10) { showError('phoneError','Valid phone number is required'); valid=false; }
  }
  
  return valid;
}

document.getElementById('checkoutForm').addEventListener('submit',e=>{
  e.preventDefault();
  clearErrors();

  const cardNum=document.getElementById('cardNumber').value;
  const email=document.getElementById('email').value;
  const expiry=document.getElementById('expiry').value;
  const cvv=document.getElementById('cvv').value;

  let valid=true;
  if(!/.+@.+\..+/.test(email)){showError('emailError','Enter a valid email');valid=false}
  if(!luhnCheck(cardNum)){showError('cardError','Invalid card number');valid=false}
  if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(expiry)){showError('expiryError','Use MM/YY format');valid=false}
  if(!/^\d{3,4}$/.test(cvv)){showError('cvvError','Enter 3â€“4 digits');valid=false}
  
  // Validate address if different address is selected
  if (!validateAddress()) valid = false;

  if(!valid) return;

  // Prepare data for submission
  const formData = {
    email: email,
    cardNumber: cardNum.replace(/\s/g, ''),
    expiry: expiry,
    cvv: cvv,
    cart: cart,
    total: cart.reduce((sum, item) => sum + (item.price * item.qty), 0) + 6.00,
    shippingAddress: {}
  };

  // Include address data if different address is selected
  if (document.getElementById('differentAddress').checked) {
    formData.shippingAddress = {
      firstName: document.getElementById('firstName').value,
      lastName: document.getElementById('lastName').value,
      address: document.getElementById('address').value,
      address2: document.getElementById('address2').value,
      city: document.getElementById('city').value,
      state: document.getElementById('state').value,
      postcode: document.getElementById('postcode').value,
      phone: document.getElementById('phone').value,
      updateUserAddress: true // Flag to update user's address in database
    };
  }

  // Simulate loading
  document.getElementById('loading').classList.remove('hidden');
  
  // In a real application, you would send this data to your server
  setTimeout(()=>{
    document.getElementById('loading').classList.add('hidden');
    
    // Show success message with order details
    alert('Payment processed successfully! Thank you for your order.\n\nOrder Total: RM ' + formatRM(formData.total));
    
    // In real scenario, redirect to order confirmation page
    // window.location.href = 'order-confirmation.php';
  },2000);
});

// Initialize
renderSummary();
populateUserData();
document.getElementById("email").focus();
</script>

</body>
</html>